<button
  class="theme-toggle-btn appearance-none border-none flex p-1.5 rounded-md text-muted-foreground hover:text-foreground hover:bg-muted transition-colors"
  aria-label="Toggle theme"
>
  <!-- Sun icon (shown in dark mode, click to go light) -->
  <svg class="theme-icon-sun size-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" />
  </svg>
  <!-- Moon icon (shown in light mode, click to go dark) -->
  <svg class="theme-icon-moon size-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
  </svg>
</button>

<script is:inline>
  ;(function() {
    var matchMedia = window.matchMedia("(prefers-color-scheme: dark)")

    function isDark() {
      var theme = localStorage.getItem("theme")
      if (theme === "dark") return true
      if (theme === "light") return false
      return matchMedia.matches
    }

    function applyTheme() {
      var dark = isDark()
      document.documentElement.classList[dark ? "add" : "remove"]("dark")
      document.querySelectorAll(".theme-icon-sun").forEach(function(el) {
        el.style.display = dark ? "block" : "none"
      })
      document.querySelectorAll(".theme-icon-moon").forEach(function(el) {
        el.style.display = dark ? "none" : "block"
      })
    }

    function bindButtons() {
      document.querySelectorAll(".theme-toggle-btn").forEach(function(btn) {
        btn.addEventListener("click", function() {
          localStorage.setItem("theme", isDark() ? "light" : "dark")
          applyTheme()
        })
      })
    }

    applyTheme()
    bindButtons()

    if (!window.__themeListenersSet) {
      window.__themeListenersSet = true

      matchMedia.addEventListener("change", function() {
        if (!localStorage.getItem("theme")) applyTheme()
      })

      // Re-apply theme and rebind after View Transitions navigation
      document.addEventListener("astro:after-swap", function() {
        applyTheme()
        bindButtons()
      })
    }
  })()
</script>
